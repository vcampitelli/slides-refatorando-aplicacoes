<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="author" content="Vinícius Campitelli, eu@viniciuscampitelli.com">

        <title>Refatorando Aplicações na Prática | Vinícius Campitelli</title>

        <link rel="stylesheet" href="reveal.js/dist/reset.css">
        <link rel="stylesheet" href="reveal.js/dist/reveal.css">
        <link rel="stylesheet" href="reveal.js/dist/theme/black.css">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/framer.min.css"
              integrity="sha512-tegeSiwBwq2gYD87Cycxj1Q5PX/y2owrYz1b0QmyEBldD9+mH+CxQK0/3FgRY37inbVLVNaARzMbLD/sl5YtCA=="
              crossorigin="anonymous" referrerpolicy="no-referrer">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet"
              href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600&family=JetBrains+Mono&display=swap">
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section id="first-slide">
                    <h1 class="title">Refatorando Aplicações<br>na Prática</h1>
                    <h2>Vinícius Campitelli</h2>
                </section>

                <section> <!-- Sobre -->
                    <section data-auto-animate data-auto-animate-restart>
                        <h1>Sobre</h1>
                    </section>
                    <section data-auto-animate>
                        <h1>Sobre</h1>
                        <h2>Sobre mim</h2>
                        <div id="about-me">
                            <div class="text-center">
                                <figure id="profile-pic">
                                    <img src="img/profile.jpg" alt="Vinícius Campitelli">
                                    <figcaption id="about-me-name">Vinícius<br>Campitelli</figcaption>
                                </figure>
                            </div>
                            <ul>
                                <li>
                                    Bacharel em Ciência da Computação pela UFSCar
                                </li>
                                <li>Desenvolvedor há mais de 15 anos</li>
                                <li>
                                    Membro do <a href="https://phpsp.org.br" target="_blank" rel="noopener">PHPSP</a>
                                </li>
                                <li>Entusiasta em cibersegurança</li>
                                <li>Consultor de TI e instrutor de treinamentos na Yampi</li>
                            </ul>
                        </div>
                        <div>
                            <div class="about-me-links">
                                <div>
                                    <svg role="img" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M15.3222 10.383C15.3796 10.9457 15.4125 11.4903 15.4125 12C15.4125 12.9541 15.2972 14.0315 15.1208 15.1208C14.0315 15.2972 12.9541 15.4125 12 15.4125C11.0502 15.4125 9.97313 15.2975 8.87911 15.1205C8.70281 14.0312 8.5875 12.954 8.5875 12C8.5875 11.4905 8.62039 10.9458 8.67789 10.383C9.82608 10.5668 10.9715 10.6875 12 10.6875C13.0286 10.6875 14.174 10.5668 15.3222 10.383Z"
                                              class="fill"/>
                                        <path d="M16.8752 10.0994C16.9462 10.7579 16.9875 11.399 16.9875 12C16.9875 12.8769 16.8997 13.8389 16.7599 14.8153C18.7425 14.4016 20.575 13.8731 21.5567 13.5722C21.8739 13.475 21.9986 13.4363 22.1658 13.3694C22.2494 13.336 22.326 13.302 22.4259 13.2543C22.4748 12.843 22.5 12.4244 22.5 12C22.5 10.878 22.324 9.79714 21.9982 8.78346L21.9133 8.81017C20.8868 9.12245 18.9652 9.6745 16.8752 10.0994Z"
                                              class="fill"/>
                                        <path d="M21.4017 7.31948C20.3698 7.63221 18.579 8.14039 16.6599 8.53603C16.2178 5.84926 15.443 3.16951 15.0702 1.95598C17.8422 2.80227 20.1273 4.76467 21.4017 7.31948Z"
                                              class="fill"/>
                                        <path d="M15.1117 8.82229C14.0253 8.99781 12.9513 9.1125 12 9.1125C11.0487 9.1125 9.97477 8.99781 8.88843 8.8223C9.30471 6.28005 10.0478 3.68306 10.4278 2.44333C10.525 2.12606 10.5637 2.00144 10.6306 1.83418C10.664 1.75062 10.698 1.67398 10.7457 1.57414C11.157 1.52518 11.5756 1.5 12 1.5C12.4434 1.5 12.8803 1.52748 13.3093 1.58083C13.3184 1.61564 13.3268 1.64679 13.3351 1.67626C13.3597 1.76333 13.3982 1.8857 13.4628 2.09104L13.4696 2.11261C13.7935 3.14223 14.6519 6.01401 15.1117 8.82229Z"
                                              class="fill"/>
                                        <path d="M7.34004 8.536C7.7801 5.86107 8.54986 3.19576 8.92192 1.98181L8.92983 1.95597C6.15777 2.80225 3.8727 4.76465 2.59835 7.31946C3.63018 7.63219 5.42095 8.14036 7.34004 8.536Z"
                                              class="fill"/>
                                        <path d="M2.00184 8.78345C1.67598 9.79714 1.5 10.878 1.5 12C1.5 12.4389 1.52693 12.8715 1.57923 13.2963L1.74471 13.3515L1.74603 13.3519L1.74765 13.3525L1.74879 13.3528C1.80205 13.3705 3.36305 13.886 5.41878 14.3975C5.99886 14.5418 6.61307 14.6844 7.24006 14.8151C7.10025 13.8388 7.0125 12.8769 7.0125 12C7.0125 11.3988 7.05374 10.7577 7.12472 10.0994C5.03428 9.67436 3.11218 9.12212 2.08597 8.80989L2.07883 8.80771L2.00184 8.78345Z"
                                              class="fill"/>
                                        <path d="M12 16.9875C12.8769 16.9875 13.8389 16.8997 14.8153 16.7599C14.4016 18.7425 13.8731 20.575 13.5722 21.5566C13.475 21.8739 13.4363 21.9985 13.3694 22.1658C13.336 22.2494 13.302 22.326 13.2543 22.4259C12.843 22.4748 12.4244 22.5 12 22.5C11.5756 22.5 11.157 22.4748 10.7457 22.4259C10.698 22.326 10.664 22.2494 10.6306 22.1658C10.5637 21.9986 10.525 21.8739 10.4278 21.5567C10.1269 20.5751 9.59846 18.7427 9.18478 16.7603C10.1579 16.8996 11.1201 16.9875 12 16.9875Z"
                                              class="fill"/>
                                        <path d="M5.0385 15.9259C3.73853 15.6024 2.63135 15.2775 1.95597 15.0702C2.97258 18.4002 5.59982 21.0274 8.92983 22.044L8.92192 22.0182C8.59705 20.9582 7.96897 18.7917 7.52191 16.4784C6.6525 16.3103 5.80722 16.1171 5.0385 15.9259Z"
                                              class="fill"/>
                                        <path d="M22.0182 15.0781C20.9582 15.403 18.7915 16.0311 16.4781 16.4781C16.0311 18.7915 15.403 20.9581 15.0781 22.0182L15.0702 22.044C18.4002 21.0274 21.0274 18.4002 22.044 15.0702L22.0182 15.0781Z"
                                              class="fill"/>
                                        <path d="M1.6103 13.323C1.64665 13.3277 1.67628 13.3327 1.68611 13.3349C1.69472 13.337 1.70821 13.3406 1.7131 13.3419L1.72391 13.345L1.72973 13.3468L1.73585 13.3487L1.74098 13.3503C1.7381 13.3494 1.67976 13.3348 1.6103 13.323Z"
                                              class="fill"/>
                                    </svg>
                                    <div>
                                        <p>Site</p>
                                        <a href="https://viniciuscampitelli.com" target="_blank" rel="noopener">
                                            viniciuscampitelli.com
                                        </a>
                                    </div>
                                </div>
                                <div>
                                    <svg role="img" viewBox="0 0 25 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
                                              class="fill"></path>
                                    </svg>
                                    <div>
                                        <p>GitHub</p>
                                        <a href="https://github.com/vcampitelli" target="_blank" rel="noopener">
                                            vcampitelli
                                        </a>
                                    </div>
                                </div>
                                <div>
                                    <svg role="img" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                              d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z"
                                              class="fill"/>
                                        <path d="M18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5Z"
                                              class="fill"/>
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                              d="M1.65396 4.27606C1 5.55953 1 7.23969 1 10.6V13.4C1 16.7603 1 18.4405 1.65396 19.7239C2.2292 20.8529 3.14708 21.7708 4.27606 22.346C5.55953 23 7.23969 23 10.6 23H13.4C16.7603 23 18.4405 23 19.7239 22.346C20.8529 21.7708 21.7708 20.8529 22.346 19.7239C23 18.4405 23 16.7603 23 13.4V10.6C23 7.23969 23 5.55953 22.346 4.27606C21.7708 3.14708 20.8529 2.2292 19.7239 1.65396C18.4405 1 16.7603 1 13.4 1H10.6C7.23969 1 5.55953 1 4.27606 1.65396C3.14708 2.2292 2.2292 3.14708 1.65396 4.27606ZM13.4 3H10.6C8.88684 3 7.72225 3.00156 6.82208 3.0751C5.94524 3.14674 5.49684 3.27659 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3.27659 5.49684 3.14674 5.94524 3.0751 6.82208C3.00156 7.72225 3 8.88684 3 10.6V13.4C3 15.1132 3.00156 16.2777 3.0751 17.1779C3.14674 18.0548 3.27659 18.5032 3.43597 18.816C3.81947 19.5686 4.43139 20.1805 5.18404 20.564C5.49684 20.7234 5.94524 20.8533 6.82208 20.9249C7.72225 20.9984 8.88684 21 10.6 21H13.4C15.1132 21 16.2777 20.9984 17.1779 20.9249C18.0548 20.8533 18.5032 20.7234 18.816 20.564C19.5686 20.1805 20.1805 19.5686 20.564 18.816C20.7234 18.5032 20.8533 18.0548 20.9249 17.1779C20.9984 16.2777 21 15.1132 21 13.4V10.6C21 8.88684 20.9984 7.72225 20.9249 6.82208C20.8533 5.94524 20.7234 5.49684 20.564 5.18404C20.1805 4.43139 19.5686 3.81947 18.816 3.43597C18.5032 3.27659 18.0548 3.14674 17.1779 3.0751C16.2777 3.00156 15.1132 3 13.4 3Z"
                                              class="fill"/>
                                    </svg>
                                    <div>
                                        <p>Instagram</p>
                                        <a href="https://instagram.com/vcampitelli" target="_blank" rel="noopener">
                                            vcampitelli
                                        </a>
                                    </div>
                                </div>
                                <div>
                                    <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"
                                              class="fill"></path>
                                    </svg>
                                    <div>
                                        <p><span class="text-muted">X</span> Twitter</p>
                                        <a href="https://twitter.com/vcampitelli" target="_blank" rel="noopener">
                                            vcampitelli
                                        </a>
                                    </div>
                                </div>
                                <div>
                                    <svg role="img" viewBox="0 0 74 74" xmlns="http://www.w3.org/2000/svg">
                                        <g fill="none" fill-rule="evenodd">
                                            <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z"
                                                  class="fill"/>
                                            <path d="M62,62 L51.315625,62 L51.315625,43.8021149 C51.315625,38.8127542 49.4197917,36.0245323 45.4707031,36.0245323 C41.1746094,36.0245323 38.9300781,38.9261103 38.9300781,43.8021149 L38.9300781,62 L28.6333333,62 L28.6333333,27.3333333 L38.9300781,27.3333333 L38.9300781,32.0029283 C38.9300781,32.0029283 42.0260417,26.2742151 49.3825521,26.2742151 C56.7356771,26.2742151 62,30.7644705 62,40.051212 L62,62 Z M16.349349,22.7940133 C12.8420573,22.7940133 10,19.9296567 10,16.3970067 C10,12.8643566 12.8420573,10 16.349349,10 C19.8566406,10 22.6970052,12.8643566 22.6970052,16.3970067 C22.6970052,19.9296567 19.8566406,22.7940133 16.349349,22.7940133 Z M11.0325521,62 L21.769401,62 L21.769401,27.3333333 L11.0325521,27.3333333 L11.0325521,62 Z"
                                                  class="fill-bg"/>
                                        </g>
                                    </svg>
                                    <div>
                                        <p>LinkedIn</p>
                                        <a href="https://linkedin.com/in/viniciuscampitelli" target="_blank"
                                           rel="noopener">
                                            Vinícius Campitelli
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </section> <!-- Sobre -->
                <section> <!-- Preparação -->
                    <section>
                        <h1>Preparação</h1>
                    </section>
                    <section>
                        <h1>Preparação</h1>
                        <h2>Slides</h2>
                        <div class="d-flex justify-start items-center">
                            <div style="flex-shrink: 0">
                                <a href="https://github.com/somosyampi/curso-refatoracao" target="_blank"
                                   rel="noopener" class="d-block">
                                    <img src="img/qrcode-slides.png" alt="Workshops" class="my-0">
                                </a>
                            </div>
                            <div class="qrcode-featured-text">
                                Acesse os <em>slides</em> em<br>
                                <a href="https://github.com/somosyampi/curso-refatoracao" target="_blank"
                                   rel="noopener" class="d-block">
                                    github.com/somosyampi/curso-refatoracao
                                </a>
                            </div>
                        </div>
                    </section>
                    <section id="preparacao-maos-na-massa">
                        <h1>Preparação</h1>
                        <h2>Mãos na massa</h2>
                        <ol>
                            <li>
                                Certifique-se que você tenha o
                                <a href="https://docs.docker.com/get-docker" target="_blank" rel="noopener">
                                    Docker
                                </a>
                                e o
                                <a href="https://docs.docker.com/compose" target="_blank" rel="noopener">
                                    Docker Compose
                                </a>
                                instalados
                            </li>
                            <li>
                                Clone o repositório
                                <a href="https://github.com/somosyampi/curso-refatoracao" target="_blank"
                                   rel="noopener">somosyampi/curso-refatoracao</a> do GitHub
                                <pre><code class="shell" data-trim>
                                    $ git clone git@github.com/somosyampi/curso-refatoracao.git
                                </code></pre>
                            </li>
                            <li>
                                Inicialize os <em>containers</em> da aplicação
                                <pre><code class="shell" data-trim>
                                    $ cd demo/app-antiga
                                    $ docker compose up -d
                                </code></pre>
                            </li>
                            <li>
                                Acesse <a href="http://localhost:8080" target="_blank" rel="noopener">localhost:8080</a>
                                em seu navegador
                            </li>
                        </ol>
                        <div class="mt-1 text-right fs-small opacity-50">
                            <a href="#/maos-na-massa">Ir para o slide <em>"Mãos na massa"</em> &#8594;</a>
                        </div>
                    </section>
                </section> <!-- Preparação -->

                <section> <!-- Conceitos -->
                    <section>
                        <h1>Conceitos</h1>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2>Coesão</h2>
                        <blockquote>
                            Relacionamento que os membros de um módulo possuem. Códigos coesos são aqueles de relação
                            forte, onde seus membros estão intimamente ligados e estão ali por um objetivo comum.
                            Membros que não são absolutamente necessários para aquele módulo não devem estar presentes
                            em códigos coesos.
                        </blockquote>
                        <a href="https://pt.stackoverflow.com/questions/81314/o-que-s%C3%A3o-os-conceitos-de-coes%C3%A3o-e-acoplamento"
                           target="_blank" rel="noopener" class="reference">
                            StackOverflow: O que são os conceitos de coesão e acoplamento?
                        </a>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2>Acoplamento</h2>
                        <blockquote>
                            Relacionamento entre os módulos. Indica quanto um módulo depende de outro para funcionar.
                            Códigos desacoplados são aqueles de relação fraca, e não dependem de outros para fazer sua
                            funcionalidade básica. É sempre desejável um baixo nível de acoplamento.
                        </blockquote>
                        <a href="https://pt.stackoverflow.com/questions/81314/o-que-s%C3%A3o-os-conceitos-de-coes%C3%A3o-e-acoplamento"
                           target="_blank" rel="noopener" class="reference">
                            StackOverflow: O que são os conceitos de coesão e acoplamento?
                        </a>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2>SOLID</h2>
                        <p>
                            Princípios que foram apresentados originalmente por Robert Martin em 2000 em seu artigo
                            <a href="https://web.archive.org/web/20150906155800/http://www.objectmentor.com/resources/articles/Principles_and_Patterns.pdf"
                               target="_blank" rel="noopener">Design Principles and Design Patterns</a>, em que
                            descreve conceitos para evitar que um <em>software</em> <b>apodreça</b>
                        </p>
                        <ol>
                            <li>
                                <em>Single Responsibility Principle</em>
                            </li>
                            <li>
                                <em>Open-Closed Principle</em>
                            </li>
                            <li>
                                <em>Liskov Substitution Principle</em>
                            </li>
                            <li>
                                <em>Interface Segregation Principle</em>
                            </li>
                            <li>
                                <em>Dependency Inversion Principle</em>
                            </li>
                        </ol>
                        <div class="alert mt-1">
                            Curiosidade: no artigo não há o acrônimo <em>SOLID</em>, pois outros princípios são
                            explicados, em outra ordem e até com nomes diferentes. Foi em 2004 que Michael Feathers
                            reordenou alguns desses conceitos e sugeriu o termo.
                        </div>
                        <div class="references">
                            <a href="https://viniciuscampitelli.com/slides-boas-praticas/#/2" target="_blank"
                               rel="noopener">
                                Meus slides sobre SOLID
                            </a>
                            <a href="https://medium.com/backticks-tildes/the-s-o-l-i-d-principles-in-pictures-b34ce2f1e898"
                               target="_blank" rel="noopener">
                                The S.O.L.I.D Principles in Pictures
                            </a>
                        </div>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2><em>Object Calisthenics</em></h2>
                        <p>
                            Conjunto de 9 regras inventadas por Jeff Bay no livro <em>The ThoughtWorks Anthology</em> de
                            2008
                        </p>
                        <ol>
                            <li><em>Only One Level Of Indentation Per Method</em></li>
                            <li><em>Don’t Use The ELSE Keyword</em></li>
                            <li><em>Wrap All Primitives And Strings</em></li>
                            <li><em>First Class Collections</em></li>
                            <li><em>One Dot Per Line</em></li>
                            <li><em>Don't Abbreviate</em></li>
                            <li><em>Keep All Entities Small</em></li>
                            <li><em>No Classes With More Than Two Instance Variables</em></li>
                            <li><em>No Getters/Setters/Properties</em></li>
                        </ol>
                        <div class="references">
                            <a href="https://viniciuscampitelli.com/slides-boas-praticas/#/3" target="_blank"
                               rel="noopener">
                                Meus slides sobre Object Calisthenics
                            </a>
                            <a href="https://williamdurand.fr/2013/06/03/object-calisthenics/" target="_blank"
                               rel="noopener">
                                Object Calisthenics (William Durand)
                            </a>
                        </div>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2><em>Code Smells</em></h2>
                        <blockquote>
                            Qualquer característica do código fonte de um programa de computador que indique a
                            possibilidade de um problema mais profundo no sistema
                        </blockquote>
                        <a href="https://pt.wikipedia.org/wiki/Code_smell" target="_blank" rel="noopener" class="reference">
                            Wikipedia: Code Smell
                        </a>
                    </section>
                    <section>
                        <h1>Conceitos</h1>
                        <h2><em>Clean Architecture</em></h2>
                        <p>
                            Abordagem para produzir sistemas testáveis e independentes de <em>frameworks</em>, UI,
                            banco de dados, ou qualquer outro agente externo
                        </p>
                        <div class="d-flex cols-2">
                            <div class="r-stack">
                                <img src="img/clean-architecture-entities.png" alt="Entities"
                                     class="fragment" data-fragment-index="1">
                                <img src="img/clean-architecture-use-cases.png" alt="Use Cases"
                                     class="fragment" data-fragment-index="2">
                                <img src="img/clean-architecture-interface-adapters.png" alt="Interface adapters"
                                     class="fragment" data-fragment-index="3">
                                <img src="img/clean-architecture-framework-and-drivers.png" alt="Framework e drivers"
                                     class="fragment" data-fragment-index="4">
                            </div>
                            <div class="r-stack">
                                <div class="fragment fade-in-then-out" data-fragment-index="1">
                                    <p class="fw-bold">
                                        <span class="text-block" style="color: #ffffca">■</span>
                                        <em>Entities</em>
                                    </p>
                                    Encapsulam regras de negócios de toda a empresa, que podem ser usadas por diferentes
                                    sistemas &mdash; geralmente são <em>models</em> e validações de seus atributos
                                </div>
                                <div class="fragment fade-in-then-out" data-fragment-index="2">
                                    <p class="fw-bold">
                                        <span class="text-block" style="color: #ffb0ac">■</span>
                                        <em>Use Cases</em>
                                    </p>
                                    Definem regras de negócios específicas da aplicação, que normalmente são um conjunto
                                    de <em>Use Cases</em> ou ações executadas sobre as <em>Entities</em>
                                </div>
                                <div class="fragment fade-in-then-out" data-fragment-index="3">
                                    <p class="fw-bold">
                                        <span class="text-block" style="color: #b3ffcb">■</span>
                                        <em>Interface Adapters</em>
                                    </p>
                                    São um conjunto de adaptadores que convertem dados de agentes externos para os
                                    <em>Use Cases</em> e <em>Entities</em>
                                </div>
                                <div class="fragment" data-fragment-index="4">
                                    <p class="fw-bold">
                                        <span class="text-block" style="color: #b7e7ff">■</span>
                                        <em>Framework e Drivers</em>
                                    </p>
                                    São serviços externos aos quais os <em>Interface Adapters</em> se conectam
                                </div>
                            </div>
                        </div>
                        <a href="https://levelup.gitconnected.com/a-quick-architecture-and-components-design-2baf0216021f"
                           target="_blank" rel="noopener" class="reference">
                            A Brief Introduction to Architecture Design Using the Clean Architecture Approach
                        </a>
                    </section>
                </section> <!-- Conceitos -->

                <section> <!-- Refatoração -->
                    <section>
                        <h1>Refatoração</h1>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2><em>Disclaimer</em></h2>
                        <ol>
                            <li class="fragment">
                                Faremos refatorações incrementais, então códigos nos <em>slides</em> intermediários
                                ainda não estão prontos e apresentam problemas
                            </li>
                            <li class="fragment">
                                Mesmo no código final pode ser ainda possível identificar melhorias, mas temos um tempo
                                limite da apresentação, logicamente
                            </li>
                            <li class="fragment">
                                Esses passos <b>não são verdade absoluta</b>: é algo que funcionou <b>para mim</b> e por
                                isso quis compartilhar, mas existem dezenas de outras formas de refatorar aplicações, e
                                cada pessoa tem sua própria abordagem
                            </li>
                        </ol>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2><em>Linting</em> e análise estática</h2>
                        <p>
                            Instale ferramentas de análise estática e <em>linting</em>, defina as regras e executa a
                            ferramenta que corrige automaticamente o estilo do código
                        </p>
                        <ul>
                            <li>
                                PHP:
                                <a href="https://github.com/squizlabs/PHP_CodeSniffer" target="_blank" rel="noopener">
                                    PHPCS</a>,
                                <a href="https://github.com/larastan/larastan" target="_blank" rel="noopener">
                                    larastan</a>,
                                <a href="https://github.com/phan/phan" target="_blank" rel="noopener">
                                    phan</a>,
                                <a href="https://psalm.dev" target="_blank" rel="noopener">
                                    psalm
                                </a> e
                                <a href="https://phpmd.org/" target="_blank" rel="noopener">
                                    PHPMD
                                </a>
                            </li>
                            <li>
                                JavaScript: <a href="https://eslint.org/" target="_blank" rel="noopener">ESLint</a>,
                                <a href="https://prettier.io/" target="_blank" rel="noopener">Prettier</a>,
                                <a href="https://biomejs.dev/" target="_blank" rel="noopener">Biome</a>
                            </li>
                            <li>
                                Python:
                                <a href="https://pypi.org/project/pylint/" target="_blank" rel="noopener">Pylint</a>,
                                <a href="https://flake8.pycqa.org/en/latest/" target="_blank" rel="noopener">Flake8</a>
                            </li>
                            <li>
                                Ruby:
                                <a href="https://rubocop.org/" target="_blank" rel="noopener">Rubocop</a>
                            </li>
                            <li>
                                Java:
                                <a href="https://checkstyle.org/" target="_blank" rel="noopener">Checkstyle</a>
                            </li>
                        </ul>
                        <div class="alert mt-1">
                            Dica: configure o <em>plugin</em> da ferramenta na sua IDE para garantir que está escrevendo
                            código de acordo com o formato configurado e adicione uma etapa no CI para rodar a checagem
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Tipar argumentos e retornos</h2>
                        <p>
                            Especifique os tipos dos argumentos e os retornos dos métodos
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    public function create(
                                        $request,
                                        $alias,
                                        $id
                                    ) {}
                                </code></pre>
                                <pre><code class="typescript" data-trim data-line-numbers>
                                    export default function create(
                                        request: any,
                                        alias: any,
                                        id: any
                                    ): any {}
                                </code></pre>
                                <p class="caption">Códigos pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    public function create(
                                        Request $request,
                                        string $alias,
                                        int $id
                                    ): Response {}
                                </code></pre>
                                <pre><code class="typescript" data-trim data-line-numbers>
                                    export default function create(
                                        request: Request,
                                        alias: string,
                                        id: number
                                    ): Entity {}
                                </code></pre>
                                <p class="caption">Códigos pós-refatoração</p>
                            </div>
                        </div>
                        <div class="alert mt-2">
                            Isso ajudará inclusive ao criar testes de unidade (já que ferramentas como o PHPUnit
                            conseguem criar <em>mocks</em> automaticamente) e também nas ferramentas de análise estática
                            (como o
                            <a href="https://github.com/larastan/larastan" target="_blank" rel="noopener">larastan</a>)
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Testes - Parte 1</h2>
                        <p>
                            Crie simples testes de contrato de suas <em>controllers</em> para ter mais confiança que a
                            refatoração não irá quebrar suas APIs
                        </p>
                        <pre><code class="php" data-trim data-line-numbers>
                            public function testProductListAction() {
                                $body = $this->makeGetRequest('/product/list')->body();
                                $this->assertArrayHasKey('status', $body);
                                $this->assertTrue($body['status']);
                                $this->assertArrayHasKey('products', $body);
                                $this->assertArrayHasKey('name', $body['products'][0]);
                                $this->assertArrayHasKey('price', $body['products'][0]);
                                $this->assertArrayHasKey('description', $body['products'][0]);
                            }
                        </code></pre>
                        <div class="alert mt-1">
                            Atenção: não é recomendado testar <em>controllers</em>, então depois iremos refatorar esses
                            testes também!
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Testes - Parte 1</h2>
                        <div class="d-flex cols-2">
                            <div>
                                <p>
                                    Adicione também uma etapa no CI para rodar esses testes e barrar
                                    <em>Pull Requests</em> que não passem
                                </p>
                            </div>
                            <div>
                                <pre><code class="yaml" data-trim data-line-numbers>
                                    on:
                                      pull_request:

                                    steps:
                                      - uses: actions@checkout
                                      - uses: shivammathur/setup-php@v2
                                      - run: composer test
                                </code></pre>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Não dependa de <em>strings</em></h2>
                        <p>
                            Use constantes ao invés de <em>strings</em> para identificadores e outros textos
                            pré-estabelecidos, diminuindo a possibilidade de errar e facilitando possíveis refatorações
                            no futuro
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    switch ($method) {
                                        case 'pagarme':
                                            // ...
                                        case 'pagseguro':
                                            // ...
                                    }
                                </code></pre>
                                <pre><code class="typescript" data-trim>
                                    if (stepBefore === 'steps.account.username') {
                                        return redirectTo('steps.account.password');
                                    }
                                </code></pre>
                                <p class="caption">Códigos pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    switch ($method) {
                                        case PagarmeGateway::IDENTIFIER:
                                            // ...
                                        case PagSeguroGateway::IDENTIFIER:
                                            // ...
                                    }
                                </code></pre>
                                <pre><code class="typescript" data-trim>
                                    enum STEPS {
                                        ACCOUNT_USERNAME = 'steps.account.username',
                                        MERCHANT_CONFIG = 'steps.merchant.config',
                                    }
                                    if (stepBefore === STEPS.ACCOUNT_USERNAME) {
                                        return redirectTo(STEPS.MERCHANT_CONFIG);
                                    }
                                </code></pre>
                                <p class="caption">Códigos pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Separe informações de sistemas externos</h2>
                        <p>
                            Ao invés de acessar os valores brutos das respostas de sistemas externos, crie abstrações,
                            como os DTOs <em>(Data Transfer Objects)</em>, diminuindo a quantidade de mudanças
                            necessárias em seu código quando houver alterações externas
                        </p>
                        <div class="r-stack">
                            <div class="w-100 fragment semi-fade-out" data-fragment-index="1">
                                <pre data-id="pre"><code class="twig" data-trim data-line-numbers>
                                    {# produtos/externos/listar.phtml #}
                                    {% for product in products %}
                                        &lt;li&gt;
                                            &lt;p&gt;{{ product.titulo }}&lt;/p&gt;
                                            R$ {{ product.preco|number_format(2, '.', ',') }}
                                        &lt;/li&gt;
                                    {% endfor %}

                                    {# produtos/externos/visualizar.phtml #}
                                    &lt;div&gt;
                                        &lt;p&gt;{{ product.titulo }}&lt;/p&gt;
                                        R$ {{ product.preco|number_format(2, '.', ',') }}
                                    &lt;/div&gt;
                                </code></pre>
                                <p class="caption">Código pré-refatoração</p>
                            </div>
                            <p class="fragment text-shadow" data-fragment-index="1">
                                E se o sistema externo mudar a resposta?
                            </p>
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Separe informações de sistemas externos</h2>
                        <p>
                            Ao invés de acessar os valores brutos das respostas de sistemas externos, crie abstrações,
                            como os DTOs <em>(Data Transfer Objects)</em>, diminuindo a quantidade de mudanças
                            necessárias em seu código quando houver alterações externas
                        </p>
                        <div class="r-stack">
                            <div class="w-100">
                                <pre data-id="pre"><code class="twig" data-trim data-line-numbers>
                                    {# produtos/externos/listar.phtml #}
                                    {% for product in products %}
                                        &lt;li&gt;
                                            &lt;p&gt;{{ product.title }}&lt;/p&gt;
                                            R$ {{ (product.price / 100)|number_format(2, '.', ',') }}
                                        &lt;/li&gt;
                                    {% endfor %}

                                    {# produtos/externos/visualizar.phtml #}
                                    &lt;div&gt;
                                        &lt;p&gt;{{ product.title }}&lt;/p&gt;
                                        R$ {{ (product.price / 100)|number_format(2, '.', ',') }}
                                    &lt;/div&gt;
                                </code></pre>
                                <p class="caption">Código pré-refatoração com mudanças no sistema externo refletidas</p>
                            </div>
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Separe informações de sistemas externos</h2>
                        <p>
                            Ao invés de acessar os valores brutos das respostas de sistemas externos, crie abstrações,
                            como os DTOs <em>(Data Transfer Objects)</em>, diminuindo a quantidade de mudanças
                            necessárias em seu código quando houver alterações externas
                        </p>
                        <div class="d-flex cols-2">
                            <div>
                                <pre data-id="pre"><code class="twig" data-trim data-line-numbers>
                                    {# produtos/externos/listar.phtml #}
                                    {% for productDto in products %}
                                        &lt;li&gt;
                                            &lt;p&gt;{{ productDto.title }}&lt;/p&gt;
                                            R$ {{ productDto.price|number_format(2, '.', ',') }}
                                        &lt;/li&gt;
                                    {% endfor %}

                                    {# produtos/externos/visualizar.phtml #}
                                    &lt;div&gt;
                                        &lt;p&gt;{{ productDto.title }}&lt;/p&gt;
                                        R$ {{ productDto.price|number_format(2, '.', ',') }}
                                    &lt;/div&gt;
                                </code></pre>
                                <p class="caption">Código pós-refatoração</p>
                            </div>
                            <div>
                                <pre data-id="pre-dto"><code class="php" data-trim data-line-numbers>
                                    class ProductDto
                                    {
                                        public static function build(
                                            stdClass $data
                                        ) {
                                            return new ProductDto(
                                                title: $data->titulo,
                                                price: $data->preco,
                                            );
                                        }
                                    }
                                </code></pre>
                                <p class="caption">DTO para isolar o sistema externo</p>
                            </div>
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Separe informações de sistemas externos</h2>
                        <p>
                            Ao invés de acessar os valores brutos das respostas de sistemas externos, crie abstrações,
                            como os DTOs <em>(Data Transfer Objects)</em>, diminuindo a quantidade de mudanças
                            necessárias em seu código quando houver alterações externas
                        </p>
                        <div class="d-flex cols-2">
                            <div>
                                <pre data-id="pre"><code class="twig" data-trim data-line-numbers>
                                    {# produtos/externos/listar.phtml #}
                                    {% for productDto in products %}
                                        &lt;li&gt;
                                            &lt;p&gt;{{ productDto.title }}&lt;/p&gt;
                                            R$ {{ productDto.price|number_format(2, '.', ',') }}
                                        &lt;/li&gt;
                                    {% endfor %}

                                    {# produtos/externos/visualizar.phtml #}
                                    &lt;div&gt;
                                        &lt;p&gt;{{ productDto.title }}&lt;/p&gt;
                                        R$ {{ productDto.price|number_format(2, '.', ',') }}
                                    &lt;/div&gt;
                                </code></pre>
                                <p class="caption">Código pós-refatoração resiliente às mudanças no sistema externo</p>
                            </div>
                            <div>
                                <pre data-id="pre-dto"><code class="php" data-trim data-line-numbers>
                                    class ProductDto
                                    {
                                        public static function build(
                                            stdClass $data
                                        ) {
                                            return new ProductDto(
                                                title: $data->title,
                                                price: $data->price / 100,
                                            );
                                        }
                                    }
                                </code></pre>
                                <p class="caption">As mudanças ocorrem apenas no DTO</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Uma ação por <em>controller</em></h2>
                        <p>
                            Ao invés de ter grandes <em>controllers</em> com vários <em>endpoints</em>, sugiro
                            dividi-los para que cada <em>endpoint</em> tenha sua própria classe (ou função, no caso de
                            JavaScript)
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class ProductController {
                                        public function create(Request $req) {}

                                        public function list(Request $req) {}

                                        public function update(Request $req) {}

                                        public function delete(Request $req) {}
                                    }
                                </code></pre>
                                <p class="caption">Código pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class CreateProductAction {
                                        public function handle(Request $req) {}
                                    }
                                    class ListProductAction {
                                        public function handle(Request $req) {}
                                    }
                                    class UpdateProductAction {
                                        public function handle(Request $req) {}
                                    }
                                    class DeleteProductAction {
                                        public function handle(Request $req) {}
                                    }
                                </code></pre>
                                <p class="caption">Código pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Isolamento de responsabilidades</h2>
                        <h3>Mantenha suas <em>controllers</em> leves</h3>
                        <p>
                            A <em>controller</em> deve ser apenas uma forma de traduzir o protocolo de entrada
                            (HTTP) para a execução das regras de negócio do seu sistema
                        </p>
                        <p>
                            Afinal, pode haver outros tipos de entrada (como ferramentas CLI ou <em>workers</em>) que
                            precisem executar as mesmas ações
                        </p>
                        <p>
                            Então, extraia as regras de negócio de suas <em>controllers</em> para novos serviços
                        </p>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Isolamento de responsabilidades</h2>
                        <h3>Mantenha suas <em>controllers</em> leves</h3>
                        <div class="r-stack">
                            <div class="fragment fade-out w-100" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class ProductCreateAction {
                                        public function handle(Request $request) {
                                            $name = (string) $request->get('name');
                                            $price = (float) $request->get('price');
                                            $description = (string) $request->get('description');
                                            $idCategory = (int) $request->get('id_category');

                                            if (empty($name)) { /* ... */ }
                                            if ((empty($price)) || ($price <= 0)) { /* ... */ }
                                            // validação dos outros campos...

                                            if (!user()->authorized('PRODUCT_CREATE')) {
                                                return response(403, 'Você não tem permissão a esse recurso');
                                            }

                                            $category = $this->categoryRepository->findById($idCategory);
                                            if ((!$category) || (!$category->active)) {
                                                return response(404, 'Categoria não encontrada');
                                            }

                                            $product = new Product($name, $description, $price, $category);
                                            $this->productRepository->save($product);

                                            return response(201);
                                        }
                                    }
                                </code></pre>
                                <p class="caption" data-id="p">Código pré-refatoração</p>
                            </div>
                            <div class="fragment w-100" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class ProductCreateAction {
                                        public function handle(Request $request) {
                                            $name = (string) $request->get('name');
                                            $price = (float) $request->get('price');
                                            $description = (string) $request->get('description');
                                            $idCategory = (int) $request->get('id_category');

                                            $useCase = new CreateProductUseCase();
                                            return $useCase->handle(
                                                new CreateProductUseCaseInput($name, $price, $description, $idCategory)
                                            );
                                        }
                                    }
                                    class CreateProductUseCaseInput {
                                        public function __construct(string $name, float $price, string $description, int $idCategory) {
                                            if (empty($input->name)) { /* ... */ }
                                            if ((empty($input->price)) || ($input->price <= 0)) { /* ... */ }
                                        }
                                    }
                                    class CreateProductUseCase {
                                        public function handle(CreateProductUseCaseInput $input) {
                                            // validação dos outros campos...

                                            if (!user()->authorized('PRODUCT_CREATE')) {
                                                return response(403, 'Você não tem permissão a esse recurso');
                                            }

                                            $category = $this->categoryRepository->findById($input->idCategory);
                                            if ((!$category) || (!$category->active)) {
                                                return response(404, 'Categoria não encontrada');
                                            }

                                            $product = new Product(
                                                $input->name,
                                                $input->description,
                                                $input->price,
                                                $category
                                            );
                                            $this->productRepository->save($product);

                                            return response(201);
                                        }
                                    }
                                </code></pre>
                                <p class="caption" data-id="p">Código pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Isolamento de responsabilidades</h2>
                        <h3>Regras de negócio</h3>
                        <p>
                            Levante regras de negócio espalhadas entre <em>controllers</em>, comandos, <em>workers</em>,
                            <em>models</em> e centralize-as no serviço criado anteriormente
                        </p>
                        <p>
                            Caso encontre discrepâncias, será preciso determinar qual regra é correta (às vezes, até em
                            reuniões com o cliente)
                        </p>
                        <figure>
                            <img src="img/usecase.svg" alt="Uso de Use Cases" class="insert-svg">
                        </figure>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Isolamento de responsabilidades</h2>
                        <h3><em>Models</em> e banco de dados</h3>
                        <p>
                            É comum termos <em>models</em> que tenham tanto regras de negócio quanto interações com o
                            banco de dados
                        </p>
                        <pre data-id="pre"><code class="php" data-trim data-line-numbers>
                            class Product {
                                public function setName(string $name) { /* Regras de negócio do nome */ }
                                public function setPrice(float $price) { /* Regras de negócio do preço */ }
                                public static function findAll() {
                                    $idStatus = [Status::ACTIVE];
                                    if (user()->permission('PRODUCT_SEE_HIDDEN')) {
                                        $idStatus[] = Status::HIDDEN;
                                    }

                                    return Db::select()
                                        ->from('products')
                                        ->where('id_status IN (?)', $idStatus)
                                        ->build()
                                        ->fetchAll();
                                }
                            }
                        </code></pre>
                        <p class="caption">Código pré-refatoração</p>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Isolamento de responsabilidades</h2>
                        <h3><em>Models</em> e banco de dados</h3>
                        <p>
                            É recomendado separar essas ações para facilitar a manutenção e os <em>mocks</em> na hora de
                            testar
                        </p>
                        <pre data-id="pre"><code class="php" data-trim data-line-numbers>
                            class Product {
                                public function setName(string $name) { /* Regras de negócio do nome */ }
                                public function setPrice(float $price) { /* Regras de negócio do preço */ }
                            }
                            class ProductRepository {
                                public function __construct(private DatabaseInterface $db) {}
                                public function findAll() {
                                    $idStatus = [Status::ACTIVE];
                                    if (user()->permission('PRODUCT_SEE_HIDDEN')) {
                                        $idStatus[] = Status::HIDDEN;
                                    }
                                    $condition = new Condition();
                                    $condition->in('id_status', $idStatus);
                                    return $this->db->find('products', $condition);
                                }
                            }
                            class PdoDatabase implements DatabaseInterface {}
                        </code></pre>
                        <p class="caption">Código pós-refatoração</p>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Princípio <em>Tell, don't ask</em></h2>
                        <p>
                            <em>Getters</em> e <em>setters</em> acabam espalhando regras de negócio e responsabilidades
                            para outras entidades do sistema
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class Time
                                    {
                                        public function getPontos(): int {
                                            return $this->pontos;
                                        }
                                        public function setPontos(
                                            int $pontos
                                        ): void {
                                            $this->pontos = $pontos;
                                        }
                                    }

                                    $time->setPontos($time->getPontos() + 3);
                                </code></pre>
                                <p class="caption">Código pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class Time
                                    {
                                        public function vence(): void
                                        {
                                            $this->pontos += 3;
                                        }
                                        public function empata(): void
                                        {
                                            $this->pontos += 1;
                                        }
                                    }

                                    $time->vence();
                                </code></pre>
                                <p class="caption">Código pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2><em>Exceptions</em></h2>
                        <p>
                            Crie <em>exceptions</em> customizadas para seus erros ao invés de usar as padrões da
                            linguagem para facilitar o tratamento
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    try {
                                        // ...
                                    } catch (Exception $e) {
                                        return response(
                                            $e->getCode() ?: 500,
                                            $e->getMessage()
                                        );
                                    }
                                </code></pre>
                                <p class="caption">Código pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    try {
                                        // ...
                                    } catch (ProductNotFoundException|ProductInactiveException $e) {
                                        return response(404, 'Produto não encontrado');
                                    } catch (SystemException $e) {
                                        $this->logger->error($e);
                                        return response(500, 'Um erro desconhecido ocorreu');
                                    } catch (UserException $e) {
                                        return response(
                                            $e->getCode() ?: 500,
                                            $e->getMessage()
                                        );
                                    }
                                </code></pre>
                                <p class="caption">Código pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Injeção de dependências</h2>
                        <p>
                            As dependências de sua classe devem ser injetadas no construtor para deixar explícito seus
                            vínculos
                        </p>
                        <div class="d-flex cols-2">
                            <div class="fragment semi-fade-out" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class CreatePaymentUseCase {
                                      public function handle() {
                                        $paymentRepository = app(
                                          MySqlPaymentRepository::class
                                        );
                                        $orderRepository = app(
                                          MongoOrderRepository::class
                                        );
                                        // ...
                                        // ...
                                      }
                                    }
                                </code></pre>
                                <p class="caption">Código pré-refatoração</p>
                            </div>
                            <div class="fragment" data-fragment-index="1">
                                <pre><code class="php" data-trim data-line-numbers>
                                    class CreatePaymentUseCase {
                                      public function __construct(
                                        private MySqlPaymentRepository $paymentRepository,
                                        private MongoOrderRepository $orderRepository,
                                      ) {
                                      }
                                      public function handle() {
                                        $this->paymentRepository->method();
                                        $this->orderRepository->method();
                                        // ...
                                      }
                                    }
                                </code></pre>
                                <p class="caption">Código pós-refatoração</p>
                            </div>
                        </div>
                    </section>
                    <section data-auto-animate data-auto-animate-restart>
                        <h1>Refatoração</h1>
                        <h2>Dependa de abstrações</h2>
                        <p>
                            Seu código não deve depender de implementações concretas, mas sim respeitar contratos
                            impostos por <em>interfaces</em>
                        </p>
                        <pre data-id="pre"><code class="php" data-trim data-line-numbers>
                            public function __construct(
                              private PdoPaymentRepository $paymentRepository,
                              private MongoOrderRepository $orderRepository,
                              private PHPMailer $mailer,
                            ) {
                            }

                            public function handle(PaymentUseCaseInput $input) {
                              $payment = $this->paymentRepository->findById($input->paymentId);
                              $order = $this->orderRepository->findByPayment($payment);
                              $this->mailer->send($to, $subject, $body);
                              // ...
                            }
                        </code></pre>
                        <p class="caption">Código pré-refatoração</p>
                    </section>
                    <section data-auto-animate>
                        <h1>Refatoração</h1>
                        <h2>Dependa de abstrações</h2>
                        <p>
                            Seu código não deve depender de implementações concretas, mas sim respeitar contratos
                            impostos por <em>interfaces</em>
                        </p>
                        <pre data-id="pre"><code class="php" data-trim data-line-numbers>
                            public function __construct(
                              private PaymentRepositoryInterface $paymentRepository,
                              private OrderRepositoryInterface $orderRepository,
                              private MailerInterface $mailer,
                            ) {
                            }

                            public function handle(PaymentUseCaseInput $input) {
                              $payment = $this->paymentRepository->findById($input->paymentId);
                              $order = $this->orderRepository->findByPayment($payment);
                              $this->mailer->send($to, $subject, $body);
                              // ...
                            }

                            interface PaymentRepositoryInterface { /* ... */ }
                            interface OrderRepositoryInterface { /* ... */ }
                            interface MailerInterface { /* ... */ }
                        </code></pre>
                        <p class="caption">Código pós-refatoração</p>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Testes - Parte 2</h2>
                        <p>
                            Refatore seus testes criados em <b>Testes - Parte 1</b> para começar a testar os
                            <em>UseCases</em> e <em>models</em> ao invés das <em>controllers</em>
                        </p>
                        <pre><code class="php" data-trim data-line-numbers>
                            public function testListActiveProductsUseCase() {
                                $products = [
                                    new Product(title: 'Produto Ativo 1', active: true),
                                    new Product(title: 'Produto Ativo 2', active: true),
                                    new Product(title: 'Produto Inativo', active: false),
                                ];

                                $mock = $this->createMock(ProductRepositoryInterface::class);
                                $mock->method('findAllActive')
                                    ->willReturn($products);

                                $useCase = new ListActiveProductsUseCase($mock);
                                $products = $useCase->handle();
                                $this->assertCount(2, $products, 'Retorna apenas 2 produtos ativos');
                            }
                        </code></pre>
                    </section>
                    <section>
                        <h1>Refatoração</h1>
                        <h2>Dicas gerais</h2>
                        <ul>
                            <li class="fragment">
                                Antes de refatorar algo, certifique-se que você possua bons testes para aquela
                                funcionalidade
                            </li>
                            <li class="fragment">
                                Utilize as funções das IDEs para refatoração, principalmente
                                <a href="https://refactoring.guru/extract-method" target="_blank" rel="noopener">
                                    Extract Method
                                </a>
                            </li>
                            <li class="fragment">
                                Dedique tempo pensando o quê &mdash; e quando &mdash; refatorar
                            </li>
                            <li class="fragment">Escolha bons nomes para variáveis e não abrevie</li>
                            <li class="fragment">
                                Não coloque <code>Abstract</code>, <code>Interface</code> ou <code>Type</code> nos nomes
                                <em>(polêmico)</em>
                            </li>
                            <li class="fragment">
                                Evite superclasses <code>Helper</code>, <code>Utils</code> ou afins
                            </li>
                        </ul>
                    </section>
                </section> <!-- Refatoração -->

                <section> <!-- Mãos na massa -->
                    <section data-auto-animate data-auto-animate-restart>
                        <h1>Mãos na massa</h1>
                    </section>
                    <section id="maos-na-massa" data-auto-animate>
                        <h1 class="title">Mãos na massa</h1>
                        <ul>
                            <li>
                                Certifique-se que você clonou o repositório e inicializou os <em>containers</em>, como
                                descrito <a href="#/preparacao-maos-na-massa">no slide de preparação</a>
                            </li>
                            <li>
                                Abra a pasta <code>demo/app-antiga</code> em sua IDE e vamos começar a refatorar juntos!
                            </li>
                        </ul>
                    </section>
                    <section data-auto-animate>
                        <h1 class="title">Mãos na massa</h1>
                        <p>
                            Essas são as requisições que usaremos para validar as principais regras de negócio do
                            sistema:
                        </p>
                        <pre><code class="shell" data-trim data-line-numbers>
                            $ curl localhost:8080/products
                            $ curl localhost:8080/products/1
                            $ curl localhost:8080/products/10
                            $ curl -X POST localhost:8080/products
                            $ curl -X POST -d 'id_category=erro' localhost:8080/products
                            $ curl -X POST -d 'id_category=1' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=A' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+nome+de+produto+muito+grande' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+produto' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+produto&sku=TESTE' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+produto&sku=TESTE00000' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+produto&sku=TESTE00000&price=0' localhost:8080/products
                            $ curl -X POST -d 'id_category=1&name=Meu+produto&sku=TESTE00000&price=10' localhost:8080/products
                            $ curl -X POST \
                                -d 'products[0][id_category]=1&products[0][name]=Meu+produto+1&products[0][sku]=BULK000001&products[0][price]=10&products[1][id_category]=2&products[1][name]=Meu+produto+2&products[1][sku]=BULK000002&products[1][price]=20' \
                                localhost:8080/products
                        </code></pre>
                    </section>
                </section> <!-- Mãos na massa -->

                <section> <!-- Referências -->
                    <section>
                        <h1>Referências</h1>
                    </section>
                    <section>
                        <h1>Referências</h1>
                        <h2>Sites</h2>
                        <ul>
                            <li>
                                <a href="https://medium.com/backticks-tildes/the-s-o-l-i-d-principles-in-pictures-b34ce2f1e898" target="_blank" rel="noopener">
                                    The S.O.L.I.D Principles in Pictures
                                </a>
                            </li>
                            <li>
                                <a href="https://williamdurand.fr/2013/06/03/object-calisthenics/" target="_blank" rel="noopener">
                                    Object Calisthenics (William Durand)
                                </a>
                            </li>
                            <li>
                                <a href="https://refactoring.com" target="_blank" rel="noopener">
                                    Refactoring.com (Martin Fowler)
                                </a>
                            </li>
                            <li>
                                <a href="https://refactoring.guru/" target="_blank" rel="noopener">
                                    Refactoring.Guru
                                </a>
                            </li>
                            <li>
                                <a href="https://www.youtube.com/watch?v=-J3wNP6u5YU" target="_blank" rel="noopener">
                                    Vídeo: Naming Things in Code
                                </a>
                            </li>
                        </ul>
                    </section>
                </section> <!-- Referências -->

                <section> <!-- Obrigado -->
                    <h1 class="text-center title">Obrigado!</h1>
                    <div class="about-me-links">
                        <div>
                            <svg role="img" width="64px" height="64px" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
                                      class="fill"></path>
                            </svg>
                            <div>
                                <p>Slides &amp; GitHub</p>
                                <a href="https://github.com/vcampitelli" target="_blank" rel="noopener">
                                    vcampitelli
                                </a>
                            </div>
                        </div>
                        <div>
                            <svg role="img" width="64px" height="64px" viewBox="0 0 24 24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"
                                      class="fill"></path>
                            </svg>
                            <div>
                                <p><span class="text-muted">X</span> Twitter</p>
                                <a href="https://twitter.com/vcampitelli" target="_blank" rel="noopener">
                                    vcampitelli
                                </a>
                            </div>
                        </div>
                        <div>
                            <svg role="img" height="64" viewBox="0 0 74 74" width="64"
                                 xmlns="http://www.w3.org/2000/svg">
                                <g fill="none" fill-rule="evenodd">
                                    <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z"
                                          class="fill"/>
                                    <path d="M62,62 L51.315625,62 L51.315625,43.8021149 C51.315625,38.8127542 49.4197917,36.0245323 45.4707031,36.0245323 C41.1746094,36.0245323 38.9300781,38.9261103 38.9300781,43.8021149 L38.9300781,62 L28.6333333,62 L28.6333333,27.3333333 L38.9300781,27.3333333 L38.9300781,32.0029283 C38.9300781,32.0029283 42.0260417,26.2742151 49.3825521,26.2742151 C56.7356771,26.2742151 62,30.7644705 62,40.051212 L62,62 Z M16.349349,22.7940133 C12.8420573,22.7940133 10,19.9296567 10,16.3970067 C10,12.8643566 12.8420573,10 16.349349,10 C19.8566406,10 22.6970052,12.8643566 22.6970052,16.3970067 C22.6970052,19.9296567 19.8566406,22.7940133 16.349349,22.7940133 Z M11.0325521,62 L21.769401,62 L21.769401,27.3333333 L11.0325521,27.3333333 L11.0325521,62 Z"
                                          class="fill-bg"/>
                                </g>
                            </svg>
                            <div>
                                <p>LinkedIn</p>
                                <a href="https://linkedin.com/in/viniciuscampitelli" target="_blank" rel="noopener">
                                    Vinícius Campitelli
                                </a>
                            </div>
                        </div>
                    </div>
                </section> <!-- Obrigado -->
            </div>
        </div>

        <script src="reveal.js/dist/reveal.js"></script>
        <script src="reveal.js/plugin/notes/notes.js"></script>
        <script src="reveal.js/plugin/highlight/highlight.js"></script>
        <script>
            document.querySelectorAll('img.insert-svg').forEach(($img) => {
                fetch($img.src).then(response => {
                    if (!response.ok) {
                        return;
                    }
                    response.text().then(contents => {
                        const $wrapper = document.createElement('div');
                        $wrapper.classList.add('svg-wrapper');
                        if ($img.dataset.id) {
                            contents = contents.replace("<svg", '<svg data-id="' + encodeURIComponent($img.dataset.id) + '"');
                        }
                        $wrapper.innerHTML = contents.replace('<?xml version="1.0" encoding="UTF-8"?>', '');
                        $img.parentNode.replaceChild($wrapper, $img);
                    });
                });
            });

            Reveal.initialize({
                hash: true,
                mouseWheel: false,
                overview: false,
                history: true,
                plugins: [RevealHighlight, RevealNotes],
                slideNumber: 'c/t',
            });
        </script>
    </body>
</html>
